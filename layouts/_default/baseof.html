<!--
  Generate and set SVG bundle
  Also set image processing options
  Currently here to avoid certain priority issues...
-->

{{- $svgBundle := resources.Get "bundle.svg" | resources.ExecuteAsTemplate "img/bundle.svg" . | minify | resources.Fingerprint "md5" -}}
{{- .Scratch.Set "svgBundle" $svgBundle -}}

{{- .Scratch.Set "highRes"    (.Site.Params.imageProc.highRes   | default (slice "1280x" "1280w")) -}}
{{- .Scratch.Set "mediumRes"  (.Site.Params.imageProc.mediumRes | default (slice "960x" "960w")) -}}
{{- .Scratch.Set "lowRes"     (.Site.Params.imageProc.lowRes    | default (slice "640x q90" "640w")) -}}

{{- .Scratch.Set "markupAutoResizeWidth" (.Site.Params.imageProc.markupAutoResizeWidth | default 1280) -}}

<!DOCTYPE html>
<html lang="{{ .Site.Language.Lang }}" data-mode="{{ if .Site.Params.Style.isDark }}dark{{ else }}light{{ end }}">
  <head prefix="og: http://ogp.me/ns#">
    {{ partial "head" . }}
  </head>

  <body>

    <header>
      {{ partial "header" . }}
    </header>

    <div class="filler">
      {{ block "main" . }}
        <!-- Stuff -->
      {{ end }}
    </div>
    
    <footer>
      {{ partial "footer" . }}
    </footer>

    <!--
      Remnant JavaScript
      If not using Hugo server, remove every "console.log()"
    -->
    
    {{ with resources.Get "js/postpone.js" | resources.ExecuteAsTemplate .Page . | minify }}

      <script>
        {{ if $.Site.IsServer }}
          {{ .Content | safeJS }}
        {{ else }}
          {{ .Content | replaceRE "console.log(.*?);" "" | safeJS }}
        {{ end }}
      </script>

    {{ end }}
    
    <!-- KaTeX -->
    {{ if or .Params.katex .Site.Params.katex .Params.math .Site.Params.math }}
      {{ partial "katex.html" . }}
    {{ end }}

  </body>
</html>
